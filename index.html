<!doctype html>

<html lang="da">
<head>
  <meta charset="utf-8">
  <title>Helga 8 Ã¥r</title>
      <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.46.0/mapbox-gl.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.46.0/mapbox-gl.css' rel='stylesheet' />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<style>
body { margin:0; padding:0; }
#map { position:absolute; top:0; bottom:0; width:100%; }
.mapboxgl-ctrl-bottom-left,
.mapboxgl-ctrl-bottom-right {
  display: none;
}
#feedback {
  background-color: #fff;
  padding: 10px;
  position: absolute;
  bottom: 0;
  left: 0;
}
</style>
</head>

<body>
  <div id='map'></div>
  <div id="feedback"></div>
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoibGFyc2ciLCJhIjoiY2o4b3FzanpwMDZodjJxbnR1dXR5eDZ4aCJ9.aWnIb6iW_MI7r2skIj6jiQ';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/larsg/cjjmiqqxz2fib2spjmmoqdq8c',
    zoom: 15,
    maxZoom: 17,
    minZoom: 15,
    center: [12.545863,55.692218],
    attributionControl: false
});

var feedback = document.getElementById('feedback')


map.on('load', function() {

  map.addLayer({
      "id": "userPosition",
      "source": {
          "type": "geojson",
          "data": {
              "type": "Point",
              "coordinates": [
                  0,
                  0
              ]
          }
      },
      "type": "circle",
      "paint": {
          "circle-radius": 10,
          "circle-color": "#ed4630"
      }
  });
      map.loadImage('https://vignette.wikia.nocookie.net/hardyboys/images/b/ba/Red_x.svg/revision/latest?cb=20090706050938', function(error, image) {
        if (error) throw error;
        map.addImage('cross', image);
        map.addLayer({
            "id": "cross",
            "type": "symbol",
            "source": {
                "type": "geojson",
                "data": {
                    "type": "FeatureCollection",
                    "features": [{
                        "type": "Feature",
                        "geometry": {
                            "type": "Point",
                            "coordinates": [12.547289935063787,55.690313091119265]
                        }
                    }]
                }
            },
            "layout": {
                "icon-image": "cross",
                "icon-size": 0.2
            }
        });
    });
    var watchID = navigator.geolocation.watchPosition(function(position) {
      feedback.innerText = position.coords.longitude + ',' + position.coords.latitude
      map.getSource('userPosition').setData({
          "type": "Point",
          "coordinates": [position.coords.longitude,position.coords.latitude]
      });
    });
    function compassHeading(alpha, beta, gamma) {

  // Convert degrees to radians
  var alphaRad = alpha * (Math.PI / 180);
  var betaRad = beta * (Math.PI / 180);
  var gammaRad = gamma * (Math.PI / 180);

  // Calculate equation components
  var cA = Math.cos(alphaRad);
  var sA = Math.sin(alphaRad);
  var cB = Math.cos(betaRad);
  var sB = Math.sin(betaRad);
  var cG = Math.cos(gammaRad);
  var sG = Math.sin(gammaRad);

  // Calculate A, B, C rotation components
  var rA = - cA * sG - sA * sB * cG;
  var rB = - sA * sG + cA * sB * cG;
  var rC = - cB * cG;

  // Calculate compass heading
  var compassHeading = Math.atan(rA / rB);

  // Convert from half unit circle to whole unit circle
  if(rB < 0) {
    compassHeading += Math.PI;
  }else if(rA < 0) {
    compassHeading += 2 * Math.PI;
  }

  // Convert radians to degrees
  compassHeading *= 180 / Math.PI;

  return compassHeading;

}

window.addEventListener('deviceorientation', function(evt) {
  var heading = null;
  feedback.innerText = 'hit me ' + evt.absolute + ' ' + evt.alpha
  if(evt.absolute === true && evt.alpha !== null) {
    heading = compassHeading(evt.alpha, evt.beta, evt.gamma);
    feedback.innerText = 'heading ' + heading
    map.rotateTo(heading, {duration:1000});
  }

  // Do something with 'heading'...

}, false);

})

</script>
</body>
</html>
